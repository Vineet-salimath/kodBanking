<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Kodbank ‚Äî Dashboard</title>
<script src="env.js"></script>
<style>

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg1:#050d2e;--bg2:#0a1854;--bg3:#0f2070;
  --glass:rgba(255,255,255,0.07);--glass2:rgba(255,255,255,0.12);
  --glass-border:rgba(255,255,255,0.18);--glass-border2:rgba(255,255,255,0.28);
  --green:#00e5a0;--green2:#00c97a;--green-g:linear-gradient(135deg,#00e5a0,#00c97a);
  --violet:#7c3aed;--violet2:#9d5cf0;--violet-g:linear-gradient(135deg,#7c3aed,#9d5cf0);
  --blue:#3b82f6;--blue2:#60a5fa;
  --text:#e8eeff;--sub:rgba(232,238,255,0.6);--muted:rgba(232,238,255,0.4);
  --red:#ff5c7a;--yellow:#fbbf24;
  --r:18px;--r2:14px;--r3:10px;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg1);color:var(--text);min-height:100vh;
  background-image:
    radial-gradient(ellipse at 15% 20%,rgba(124,58,237,0.35) 0%,transparent 50%),
    radial-gradient(ellipse at 85% 70%,rgba(0,229,160,0.2) 0%,transparent 50%),
    radial-gradient(ellipse at 50% 50%,rgba(59,130,246,0.15) 0%,transparent 60%),
    linear-gradient(160deg,var(--bg1) 0%,var(--bg2) 50%,var(--bg3) 100%)}

/* Glass panel */
.glass{background:var(--glass);border:1px solid var(--glass-border);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-radius:var(--r)}
.glass2{background:var(--glass2);border:1px solid var(--glass-border2);
  backdrop-filter:blur(32px);-webkit-backdrop-filter:blur(32px);border-radius:var(--r)}
.glass-sm{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.12);
  backdrop-filter:blur(16px);border-radius:var(--r2)}

/* Buttons */
.btn-green{display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:14px 28px;border:none;border-radius:var(--r2);cursor:pointer;
  background:var(--green-g);color:#051a10;font-weight:800;font-size:14px;
  box-shadow:0 0 32px rgba(0,229,160,0.45),0 4px 16px rgba(0,0,0,0.3);
  transition:transform .2s,box-shadow .2s;font-family:'Inter',sans-serif}
.btn-green:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 0 48px rgba(0,229,160,0.6),0 8px 24px rgba(0,0,0,0.3)}
.btn-green:active:not(:disabled){transform:scale(.97)}
.btn-green:disabled{opacity:.5;cursor:not-allowed}

.btn-violet{display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:14px 28px;border:none;border-radius:var(--r2);cursor:pointer;
  background:var(--violet-g);color:#fff;font-weight:800;font-size:14px;
  box-shadow:0 0 32px rgba(124,58,237,0.45),0 4px 16px rgba(0,0,0,0.3);
  transition:transform .2s,box-shadow .2s;font-family:'Inter',sans-serif}
.btn-violet:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 0 48px rgba(124,58,237,0.6)}
.btn-violet:active:not(:disabled){transform:scale(.97)}
.btn-violet:disabled{opacity:.5;cursor:not-allowed}

.btn-ghost{display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 22px;border:1px solid var(--glass-border2);border-radius:var(--r2);
  background:rgba(255,255,255,0.06);color:var(--text);font-weight:600;font-size:13px;cursor:pointer;
  transition:all .2s;font-family:'Inter',sans-serif}
.btn-ghost:hover{background:rgba(255,255,255,0.12);border-color:rgba(255,255,255,0.35)}

/* Inputs */
.field{position:relative;margin-bottom:18px}
.field input,.field select,.field textarea{
  width:100%;background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);border-radius:var(--r2);
  padding:20px 16px 8px;color:var(--text);font-size:14px;
  font-family:'Inter',sans-serif;outline:none;
  transition:all .25s;-webkit-appearance:none}
.field select option{background:#0a1854}
.field label{position:absolute;left:16px;top:50%;transform:translateY(-50%);
  font-size:14px;color:var(--muted);pointer-events:none;transition:all .2s}
.field input:focus,.field input:not(:placeholder-shown),
.field select:focus,.field select:valid{
  border-color:var(--green);background:rgba(0,229,160,0.06);
  box-shadow:0 0 0 3px rgba(0,229,160,0.15),0 0 20px rgba(0,229,160,0.1)}
.field input:focus~label,.field input:not(:placeholder-shown)~label,
.field select:focus~label,.field select:valid~label{
  top:11px;transform:translateY(0) scale(.75);color:var(--green)}
.err{font-size:11px;color:var(--red);margin-top:4px;display:none}
.err.show{display:block}

/* Alert */
.alert{padding:13px 16px;border-radius:var(--r3);font-size:13px;
  margin-bottom:18px;display:none;align-items:center;gap:10px;font-weight:500}
.alert.show{display:flex}
.alert.error{background:rgba(255,92,122,0.12);border:1px solid rgba(255,92,122,0.3);color:var(--red)}
.alert.success{background:rgba(0,229,160,0.12);border:1px solid rgba(0,229,160,0.3);color:var(--green)}

/* Spinner */
.spinner{display:inline-block;width:15px;height:15px;
  border:2px solid rgba(255,255,255,0.2);border-top-color:var(--green);
  border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:7px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes glow{0%,100%{opacity:.6}50%{opacity:1}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

/* Grid dots background */
.dot-grid{position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:radial-gradient(rgba(255,255,255,0.07) 1px,transparent 1px);
  background-size:36px 36px}

/* Scrollbar */
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(124,58,237,0.4);border-radius:99px}

html,body{height:100%;overflow:hidden}
body{display:flex}
.sidebar{width:240px;height:100vh;flex-shrink:0;background:rgba(5,13,46,0.8);border-right:1px solid rgba(255,255,255,0.1);backdrop-filter:blur(20px);display:flex;flex-direction:column;position:relative;z-index:30}
.sb-logo{display:flex;align-items:center;gap:12px;padding:22px 20px 20px;border-bottom:1px solid rgba(255,255,255,0.08)}
.sb-li{width:38px;height:38px;border-radius:11px;background:var(--green-g);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:17px;color:#051a10;box-shadow:0 0 20px rgba(0,229,160,0.4);flex-shrink:0}
.sb-name{font-size:18px;font-weight:800}
.sb-nav{flex:1;padding:14px 10px;display:flex;flex-direction:column;gap:3px;overflow-y:auto}
.sb-section{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;padding:10px 12px 4px;margin-top:6px}
.nav-item{display:flex;align-items:center;gap:11px;padding:10px 13px;border-radius:11px;cursor:pointer;color:var(--sub);font-size:13.5px;font-weight:500;border:1px solid transparent;text-decoration:none;transition:all .2s}
.nav-item:hover{background:rgba(255,255,255,0.06);color:var(--text)}
.nav-item.active{background:linear-gradient(135deg,rgba(0,229,160,0.12),rgba(124,58,237,0.1));border-color:rgba(0,229,160,0.25);color:var(--text);font-weight:600}
.nav-icon{font-size:16px;width:22px;text-align:center;flex-shrink:0}
.nav-pill{margin-left:auto;background:var(--green);color:#051a10;font-size:9px;font-weight:800;padding:2px 7px;border-radius:99px}
.sb-bottom{padding:14px 10px;border-top:1px solid rgba(255,255,255,0.08)}
.sb-user{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);cursor:pointer;transition:all .2s}
.sb-user:hover{background:rgba(255,255,255,0.09)}
.sb-avatar{width:35px;height:35px;border-radius:10px;background:var(--green-g);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#051a10;flex-shrink:0}
.sb-uname{font-size:13px;font-weight:700;color:var(--text)}
.sb-urole{font-size:10px;color:var(--muted)}
.sb-logout{margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:17px;padding:4px;border-radius:6px;transition:all .2s}
.sb-logout:hover{color:var(--red);background:rgba(255,92,122,0.1)}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;z-index:1}
.topbar{height:60px;border-bottom:1px solid rgba(255,255,255,0.08);background:rgba(5,13,46,0.6);backdrop-filter:blur(20px);display:flex;align-items:center;padding:0 26px;gap:14px;flex-shrink:0}
.topbar-title{font-size:15px;font-weight:700;flex:1}
.search-box{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:8px 14px;transition:all .2s}
.search-box:focus-within{border-color:rgba(0,229,160,0.4);background:rgba(0,229,160,0.05);box-shadow:0 0 16px rgba(0,229,160,0.1)}
.search-box input{background:none;border:none;outline:none;color:var(--text);font-size:13px;width:160px;font-family:'Inter',sans-serif}
.search-box input::placeholder{color:var(--muted)}
.topbar-right{display:flex;align-items:center;gap:8px}
.icon-btn{position:relative;width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:all .2s}
.icon-btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.2)}
.icon-btn .badge{position:absolute;top:-4px;right:-4px;width:16px;height:16px;border-radius:50%;background:var(--red);border:2px solid var(--bg1);font-size:8px;font-weight:800;display:flex;align-items:center;justify-content:center;color:#fff}
.notif-dropdown{position:absolute;top:52px;right:0;width:320px;z-index:100;display:none;animation:fadeUp .2s ease}
.notif-dropdown.open{display:block}
.notif-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.08);font-size:13px;font-weight:700}
.notif-clear{font-size:11px;color:var(--green);cursor:pointer;font-weight:600}
.notif-item{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.05);cursor:pointer;transition:background .2s}
.notif-item:hover{background:rgba(255,255,255,0.04)}
.notif-icon{width:32px;height:32px;border-radius:9px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:15px}
.notif-text{font-size:12px;font-weight:600;margin-bottom:2px}
.notif-time{font-size:10px;color:var(--muted)}
.settings-dropdown{position:absolute;top:52px;right:0;width:220px;z-index:100;display:none;animation:fadeUp .2s ease;padding:8px}
.settings-dropdown.open{display:block}
.setting-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:9px;cursor:pointer;font-size:13px;font-weight:500;color:var(--sub);transition:all .2s}
.setting-item:hover{background:rgba(255,255,255,0.07);color:var(--text)}
.setting-item.danger:hover{background:rgba(255,92,122,0.1);color:var(--red)}
.content{flex:1;overflow-y:auto;padding:26px 28px}
.page{display:none;animation:fadeUp .3s ease both}
.page.active{display:block}
.card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:18px;padding:22px;backdrop-filter:blur(16px)}
.card-sm{padding:16px}
.card-title{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.card-title a{margin-left:auto;font-size:11px;color:var(--green);cursor:pointer;text-transform:none;letter-spacing:0;text-decoration:none;font-weight:600}
.card-title a:hover{text-decoration:underline}
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
.page-h1{font-size:20px;font-weight:800}
.greet-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
.greet-left h1{font-size:22px;font-weight:800;letter-spacing:-.3px}
.greet-left h1 em{font-style:normal;background:linear-gradient(135deg,#00e5a0,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.greet-left p{font-size:13px;color:var(--muted);margin-top:3px}
.greet-date{text-align:right;font-size:12px;color:var(--muted)}
.greet-date strong{display:block;color:var(--text);font-size:14px;font-weight:600}
.balance-hero{border-radius:22px;padding:28px 30px;margin-bottom:18px;position:relative;overflow:hidden;background:linear-gradient(135deg,rgba(0,229,160,0.12),rgba(124,58,237,0.15),rgba(59,130,246,0.08));border:1px solid rgba(255,255,255,0.15);backdrop-filter:blur(24px)}
.bh-glow{position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse at 80% 50%,rgba(0,229,160,0.18) 0%,transparent 60%),radial-gradient(ellipse at 20% 80%,rgba(124,58,237,0.15) 0%,transparent 50%)}
.bh-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;position:relative;z-index:2}
.bh-label{font-size:11px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:.1em}
.bh-acct{font-size:11px;color:rgba(255,255,255,0.3);margin-top:3px}
.bh-live{display:inline-flex;align-items:center;gap:6px;font-size:10px;color:var(--green);background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.2);padding:4px 10px;border-radius:99px;font-weight:700}
.bh-live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:glow 1.8s infinite}
.bh-amount{font-size:48px;font-weight:900;letter-spacing:-1.5px;line-height:1;position:relative;z-index:2;background:linear-gradient(135deg,#fff,rgba(255,255,255,0.75));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.bh-name{font-size:13px;color:rgba(255,255,255,0.4);margin-top:6px;position:relative;z-index:2}
.bh-actions{display:flex;gap:10px;margin-top:20px;position:relative;z-index:2;flex-wrap:wrap}
.bh-btn{flex:1;min-width:120px;padding:10px 16px;border-radius:10px;border:none;cursor:pointer;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .2s;font-family:'Inter',sans-serif}
.bh-btn.primary{background:var(--green-g);color:#051a10;box-shadow:0 0 20px rgba(0,229,160,0.35)}
.bh-btn.primary:hover{box-shadow:0 0 32px rgba(0,229,160,0.55);transform:translateY(-1px)}
.bh-btn.secondary{background:rgba(124,58,237,0.25);color:#fff;border:1px solid rgba(124,58,237,0.4)}
.bh-btn.secondary:hover{background:rgba(124,58,237,0.4)}
.bh-btn.ghost{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.7);border:1px solid rgba(255,255,255,0.12)}
.bh-btn.ghost:hover{background:rgba(255,255,255,0.14)}
.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}
.stat-card{border-radius:16px;padding:18px 16px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);display:flex;align-items:flex-start;gap:12px;transition:all .3s}
.stat-card:hover{background:rgba(255,255,255,0.07);transform:translateY(-2px)}
.stat-ic{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0}
.stat-l{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em}
.stat-v{font-size:16px;font-weight:800;margin-top:3px}
.stat-ch{font-size:10px;margin-top:2px}
.up{color:var(--green)}.down{color:var(--red)}.neu{color:var(--muted)}
.grid23{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin-top:18px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.qa-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.qa-btn{border-radius:13px;padding:15px 12px;text-align:center;cursor:pointer;transition:all .2s;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09)}
.qa-btn:hover{background:rgba(0,229,160,0.08);border-color:rgba(0,229,160,0.25);transform:translateY(-2px)}
.qa-icon{font-size:22px;margin-bottom:6px}
.qa-name{font-size:12px;font-weight:700}
.chart-area{height:72px;display:flex;align-items:flex-end;gap:5px;padding-top:8px}
.cbar{flex:1;border-radius:4px 4px 0 0;transition:height .6s ease;cursor:pointer;position:relative}
.cbar:hover::after{content:attr(data-v);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);font-size:9px;color:#fff;background:rgba(0,0,0,.7);padding:2px 5px;border-radius:4px;white-space:nowrap;margin-bottom:2px}
.cbar-lbl{font-size:8px;color:var(--muted);text-align:center;margin-top:3px}
.tx-list{display:flex;flex-direction:column;gap:8px}
.tx-item{display:flex;align-items:center;gap:12px;padding:11px 12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid transparent;transition:all .2s;cursor:default}
.tx-item:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.1)}
.tx-ico{width:38px;height:38px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:16px}
.tx-info{flex:1;min-width:0}
.tx-desc{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tx-meta{font-size:10px;color:var(--muted);margin-top:2px}
.tx-right{text-align:right;flex-shrink:0}
.tx-amt{font-size:13px;font-weight:800}
.tx-badge{display:inline-block;font-size:9px;font-weight:700;padding:2px 7px;border-radius:99px;margin-top:3px;text-transform:uppercase;letter-spacing:.04em}
.bc{background:rgba(0,229,160,0.12);color:var(--green);border:1px solid rgba(0,229,160,0.2)}
.bd{background:rgba(255,92,122,0.12);color:var(--red);border:1px solid rgba(255,92,122,0.2)}
.bp{background:rgba(251,191,36,0.12);color:var(--yellow);border:1px solid rgba(251,191,36,0.2)}
.transfer-wrap{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:900px}
.form-row{margin-bottom:16px}
.form-label{font-size:11px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.06em;margin-bottom:7px}
.form-inp{width:100%;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.12);border-radius:12px;padding:12px 14px;color:var(--text);font-size:14px;font-family:'Inter',sans-serif;outline:none;transition:all .2s}
.form-inp:focus{border-color:var(--green);box-shadow:0 0 0 3px rgba(0,229,160,0.12);background:rgba(0,229,160,0.05)}
.form-inp::placeholder{color:var(--muted)}
.tf-preview{background:linear-gradient(135deg,rgba(0,229,160,0.08),rgba(124,58,237,0.06));border:1px solid rgba(0,229,160,0.2);border-radius:14px;padding:18px;margin-top:14px}
.tf-row{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:13px}
.tf-row:last-child{border-bottom:none}
.tf-key{color:var(--muted)}
.tf-val{font-weight:700}
.tf-big{font-size:22px;font-weight:900;color:var(--green)}
.filter-row{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.filter-btn{padding:7px 15px;border-radius:9px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);color:var(--sub);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif}
.filter-btn:hover,.filter-btn.active{background:rgba(0,229,160,0.1);border-color:rgba(0,229,160,0.3);color:var(--green)}
.tx-table{width:100%;border-collapse:collapse}
.tx-table th{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.07em;padding:10px 14px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.08)}
.tx-table td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.04);font-size:13px;vertical-align:middle}
.tx-table tr:hover td{background:rgba(255,255,255,0.03)}
.tx-table tr:last-child td{border-bottom:none}
.paginator{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
.page-info{font-size:12px;color:var(--muted)}
.page-btns{display:flex;gap:6px}
.page-btn{padding:6px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);color:var(--sub);font-size:12px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif}
.page-btn:hover:not(:disabled){background:rgba(0,229,160,0.1);border-color:rgba(0,229,160,0.3);color:var(--green)}
.page-btn:disabled{opacity:.35;cursor:not-allowed}
.vcard{width:340px;height:202px;border-radius:22px;padding:22px 24px;position:relative;overflow:hidden;background:linear-gradient(135deg,#1a0840,#2d1269,#0a1854,#062a1c);box-shadow:0 24px 64px rgba(0,0,0,0.6),0 0 0 1px rgba(255,255,255,0.12) inset,0 0 60px rgba(0,229,160,0.12)}
.vcard::before{content:'';position:absolute;top:-40px;right:-40px;width:200px;height:200px;border-radius:50%;background:radial-gradient(rgba(0,229,160,0.3),transparent 65%)}
.vcard::after{content:'';position:absolute;bottom:-30px;left:-20px;width:180px;height:180px;border-radius:50%;background:radial-gradient(rgba(124,58,237,0.3),transparent 65%)}
.vc-top{display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2}
.vc-bank{font-size:14px;font-weight:900;letter-spacing:.5px;color:rgba(255,255,255,0.9)}
.vc-chip{width:36px;height:26px;border-radius:5px;background:linear-gradient(135deg,#fbbf24,#f59e0b)}
.vc-num{font-size:15px;letter-spacing:4px;color:rgba(255,255,255,0.75);font-family:monospace;margin:18px 0 14px;position:relative;z-index:2}
.vc-bottom{display:flex;justify-content:space-between;position:relative;z-index:2}
.vc-field{display:flex;flex-direction:column;gap:2px}
.vc-fl{font-size:8px;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:.5px}
.vc-fv{font-size:13px;font-weight:700;color:rgba(255,255,255,0.85)}
.vc-net{font-size:22px;font-style:italic;font-weight:900;color:rgba(255,255,255,0.7)}
.card-row{display:flex;gap:20px;flex-wrap:wrap;margin-bottom:20px}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.info-item{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);border-radius:13px;padding:14px}
.info-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px}
.info-val{font-size:14px;font-weight:700}
.profile-hdr{display:flex;align-items:center;gap:18px;margin-bottom:22px}
.profile-av{width:70px;height:70px;border-radius:18px;background:var(--green-g);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:28px;color:#051a10;box-shadow:0 0 30px rgba(0,229,160,0.4)}
.profile-name{font-size:21px;font-weight:800}
.profile-role{font-size:12px;color:var(--muted);margin-top:3px}
.profile-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.pf-field{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);border-radius:13px;padding:14px}
.pf-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px}
.pf-val{font-size:14px;font-weight:700}
.pill{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:700;padding:3px 9px;border-radius:99px;text-transform:uppercase;letter-spacing:.05em}
.pill-green{background:rgba(0,229,160,0.12);color:var(--green);border:1px solid rgba(0,229,160,0.25)}
.pill-violet{background:rgba(124,58,237,0.12);color:var(--violet2);border:1px solid rgba(124,58,237,0.25)}
.market-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.ticker-row{display:flex;align-items:center;gap:12px;padding:11px 14px;border-radius:11px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:all .2s}
.ticker-row:hover{background:rgba(0,229,160,0.05);border-color:rgba(0,229,160,0.15)}
.ticker-sym{font-size:13px;font-weight:800;width:54px;color:var(--text)}
.ticker-name{font-size:11px;color:var(--muted);flex:1}
.ticker-price{font-size:13px;font-weight:800;text-align:right}
.ticker-chg{font-size:10px;text-align:right;margin-top:1px;font-weight:600}
.news-item{padding:14px;border-radius:13px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);cursor:pointer;transition:all .2s;margin-bottom:8px}
.news-item:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.14)}
.news-cat{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:.1em;color:var(--green)}
.news-title{font-size:13px;font-weight:600;margin:5px 0;line-height:1.4}
.news-meta{font-size:11px;color:var(--muted)}
.wb-item{padding:12px 14px;border-radius:11px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);margin-bottom:8px}
.wb-name{font-size:13px;font-weight:700}
.wb-desc{font-size:11px;color:var(--muted);margin-top:3px}
.wb-meta{display:flex;gap:14px;margin-top:6px;font-size:10px;color:var(--muted)}
.tickers-list{display:flex;flex-direction:column;gap:6px}
.section-title{font-size:13px;font-weight:800;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.divider{height:1px;background:rgba(255,255,255,0.07);margin:16px 0}
.empty{text-align:center;padding:28px;color:var(--muted);font-size:13px}
.loading-center{display:flex;align-items:center;justify-content:center;gap:8px;padding:24px;color:var(--muted);font-size:13px}
.mb18{margin-bottom:18px}
@media(max-width:900px){
  .sidebar{width:56px}
  .sidebar .sb-name,.sidebar .nav-item span,.sidebar .sb-uname,.sidebar .sb-urole,.sidebar .sb-section,.sidebar .nav-pill{display:none}
  .sidebar .nav-item,.sidebar .sb-logo{justify-content:center;padding:12px}
  .transfer-wrap,.market-grid,.grid23,.grid2,.profile-grid,.info-grid,.grid4{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>
<div class="dot-grid"></div>
<nav class="sidebar">
  <div class="sb-logo"><div class="sb-li">K</div><span class="sb-name">Kodbank</span></div>
  <div class="sb-nav">
    <div class="sb-section">Main</div>
    <a class="nav-item active" data-page="dashboard" onclick="nav(this,'dashboard')"><span class="nav-icon">üè†</span><span>Dashboard</span></a>
    <a class="nav-item" data-page="transfer" onclick="nav(this,'transfer')"><span class="nav-icon">‚ÜóÔ∏è</span><span>Transfer</span></a>
    <a class="nav-item" data-page="transactions" onclick="nav(this,'transactions')"><span class="nav-icon">üìã</span><span>Transactions</span></a>
    <div class="sb-section">Account</div>
    <a class="nav-item" data-page="cards" onclick="nav(this,'cards')"><span class="nav-icon">üí≥</span><span>My Card</span></a>
    <a class="nav-item" data-page="profile" onclick="nav(this,'profile')"><span class="nav-icon">üë§</span><span>Profile</span></a>
    <div class="sb-section">Insights</div>
    <a class="nav-item" data-page="market" onclick="nav(this,'market')"><span class="nav-icon">üìà</span><span>Market</span><span class="nav-pill">Live</span></a>
  </div>
  <div class="sb-bottom">
    <div class="sb-user">
      <div class="sb-avatar" id="sbAvatar">?</div>
      <div><div class="sb-uname" id="sbName">Loading...</div><div class="sb-urole">Customer</div></div>
      <button class="sb-logout" id="logoutBtn" title="Sign out">x</button>
    </div>
  </div>
</nav>
<div class="main">
  <div class="topbar">
    <div class="topbar-title" id="topTitle">Dashboard</div>
    <div class="search-box">
      <span style="color:var(--muted);font-size:14px">üîç</span>
      <input type="text" placeholder="Search transactions..." id="searchInput" oninput="onSearch()"/>
    </div>
    <div class="topbar-right">
      <div style="position:relative">
        <div class="icon-btn" id="notifBtn" title="Notifications">üîî<div class="badge" id="notifBadge" style="display:none"></div></div>
        <div class="glass2 notif-dropdown" id="notifDropdown">
          <div class="notif-header"><span>Notifications</span><span class="notif-clear" onclick="clearAllNotifs()">Clear all</span></div>
          <div id="notifList"></div>
        </div>
      </div>
      <div style="position:relative">
        <div class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</div>
        <div class="glass2 settings-dropdown" id="settingsDropdown">
          <div class="setting-item" onclick="nav(document.querySelector('[data-page=profile]'),'profile');closeDropdowns()"><span>üë§</span> My Profile</div>
          <div class="setting-item" onclick="toggleTheme()"><span>üé®</span> Toggle Theme</div>
          <div class="setting-item" onclick="exportData()"><span>üì§</span> Export Data</div>
          <div class="setting-item danger" onclick="confirmLogout()"><span>x</span> Sign Out</div>
        </div>
      </div>
    </div>
  </div>
  <div class="content">
    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="greet-row">
        <div class="greet-left"><h1>Hello, <em id="greetName">...</em> üëã</h1><p>Here's your financial overview</p></div>
        <div class="greet-date"><strong id="dateStr"></strong><span id="timeStr"></span></div>
      </div>
      <div class="balance-hero">
        <div class="bh-glow"></div>
        <div class="bh-top">
          <div><div class="bh-label">Available Balance</div><div class="bh-acct" id="bhAcct"></div></div>
          <div class="bh-live"><span class="bh-live-dot"></span>Live</div>
        </div>
        <div class="bh-amount" id="balVal">Loading...</div>
        <div class="bh-name" id="balName"></div>
        <div class="bh-actions">
          <button class="bh-btn primary" onclick="nav(document.querySelector('[data-page=transfer]'),'transfer')">‚ÜóÔ∏è Send Money</button>
          <button class="bh-btn secondary" onclick="nav(document.querySelector('[data-page=transactions]'),'transactions')">üìã History</button>
          <button class="bh-btn ghost" onclick="refreshBal()">‚Üª Refresh</button>
          <button class="bh-btn ghost" id="hideBal" onclick="toggleBal()">üëÅ Hide</button>
        </div>
      </div>
      <div class="grid4">
        <div class="stat-card"><div class="stat-ic" style="background:rgba(0,229,160,0.1)">üí∞</div><div><div class="stat-l">Total Credit</div><div class="stat-v up" id="stCredit">...</div><div class="stat-ch up" id="stCreditC"></div></div></div>
        <div class="stat-card"><div class="stat-ic" style="background:rgba(255,92,122,0.1)">üí∏</div><div><div class="stat-l">Total Debit</div><div class="stat-v down" id="stDebit">...</div><div class="stat-ch down" id="stDebitC"></div></div></div>
        <div class="stat-card"><div class="stat-ic" style="background:rgba(251,191,36,0.1)">‚è≥</div><div><div class="stat-l">Pending</div><div class="stat-v" style="color:var(--yellow)" id="stPending">...</div><div class="stat-ch neu" id="stPendingC"></div></div></div>
        <div class="stat-card"><div class="stat-ic" style="background:rgba(59,130,246,0.1)">üìä</div><div><div class="stat-l">Transactions</div><div class="stat-v" style="color:var(--blue2)" id="stCount">...</div><div class="stat-ch neu">Total</div></div></div>
      </div>
      <div class="grid23">
        <div class="card">
          <div class="card-title">üìã Recent Transactions<a onclick="nav(document.querySelector('[data-page=transactions]'),'transactions')">View all</a></div>
          <div class="tx-list" id="recentTx"><div class="loading-center"><span class="spinner"></span>Loading...</div></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:16px">
          <div class="card card-sm">
            <div class="card-title">üìà Monthly Activity</div>
            <div class="chart-area" id="chartBars"></div>
            <div style="display:flex;gap:5px;margin-top:4px" id="chartLabels"></div>
          </div>
          <div class="card card-sm">
            <div class="card-title">‚ö° Quick Actions</div>
            <div class="qa-grid">
              <div class="qa-btn" onclick="nav(document.querySelector('[data-page=transfer]'),'transfer')"><div class="qa-icon">‚ÜóÔ∏è</div><div class="qa-name">Transfer</div></div>
              <div class="qa-btn" onclick="nav(document.querySelector('[data-page=transactions]'),'transactions')"><div class="qa-icon">üìã</div><div class="qa-name">History</div></div>
              <div class="qa-btn" onclick="nav(document.querySelector('[data-page=cards]'),'cards')"><div class="qa-icon">üí≥</div><div class="qa-name">My Card</div></div>
              <div class="qa-btn" onclick="nav(document.querySelector('[data-page=market]'),'market')"><div class="qa-icon">üìà</div><div class="qa-name">Market</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- TRANSFER -->
    <div class="page" id="page-transfer">
      <div class="page-header"><div class="page-h1">‚ÜóÔ∏è Send Money</div></div>
      <div class="transfer-wrap">
        <div class="card">
          <div id="tf-alert" class="alert"></div>
          <div class="form-row"><div class="form-label">Recipient Username</div><input class="form-inp" id="tf-rec" type="text" placeholder="Enter username" oninput="tfPreview()"/></div>
          <div class="form-row"><div class="form-label">Amount (Rs.)</div><input class="form-inp" id="tf-amt" type="number" min="1" placeholder="0.00" oninput="tfPreview()"/></div>
          <div class="form-row"><div class="form-label">Description (optional)</div><input class="form-inp" id="tf-desc" type="text" placeholder="e.g. Rent, Dinner split"/></div>
          <div id="tf-preview" style="display:none" class="tf-preview">
            <div class="tf-row"><span class="tf-key">From</span><span class="tf-val" id="tpFrom">-</span></div>
            <div class="tf-row"><span class="tf-key">To</span><span class="tf-val" id="tpTo">-</span></div>
            <div class="tf-row"><span class="tf-key">Amount</span><span class="tf-big" id="tpAmt">-</span></div>
            <div class="tf-row"><span class="tf-key">Fee</span><span class="tf-val up">Rs. 0.00 (Free)</span></div>
          </div>
          <button class="btn-green" id="tfBtn" onclick="doTransfer()" style="width:100%;margin-top:8px;padding:14px">Send Money</button>
        </div>
        <div class="card">
          <div class="card-title">Your Balance</div>
          <div style="font-size:32px;font-weight:900" id="tfBalDisp" class="up">Loading...</div>
          <div class="divider"></div>
          <div class="card-title">Tips</div>
          <div style="font-size:12px;color:var(--sub);line-height:1.8">
            <p>Verify recipient username before sending.</p>
            <p>Transfers are instant and free.</p>
            <p>All transfers logged in History.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- TRANSACTIONS -->
    <div class="page" id="page-transactions">
      <div class="page-header"><div class="page-h1">üìã Transaction History</div><div style="font-size:12px;color:var(--muted)" id="txCountLbl"></div></div>
      <div class="filter-row">
        <button class="filter-btn active" onclick="filterTx('all',this)">All</button>
        <button class="filter-btn" onclick="filterTx('credit',this)">Credit</button>
        <button class="filter-btn" onclick="filterTx('debit',this)">Debit</button>
        <button class="filter-btn" onclick="filterTx('pending',this)">Pending</button>
      </div>
      <div class="card" style="overflow:auto">
        <table class="tx-table">
          <thead><tr><th>Date</th><th>Description</th><th>Type</th><th>Recipient</th><th>Amount</th><th>Status</th></tr></thead>
          <tbody id="txBody"><tr><td colspan="6"><div class="loading-center"><span class="spinner"></span>Loading...</div></td></tr></tbody>
        </table>
      </div>
      <div class="paginator">
        <div class="page-info" id="txPageInfo"></div>
        <div class="page-btns">
          <button class="page-btn" id="btnPrev" onclick="changePage(-1)">Prev</button>
          <button class="page-btn" id="btnNext" onclick="changePage(1)">Next</button>
        </div>
      </div>
    </div>
    <!-- CARDS -->
    <div class="page" id="page-cards">
      <div class="page-header"><div class="page-h1">üí≥ My Card</div></div>
      <div class="card-row">
        <div class="vcard">
          <div class="vc-top"><div class="vc-bank">KODBANK</div><div class="vc-chip"></div></div>
          <div class="vc-num" id="vcNum">4000 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8219</div>
          <div class="vc-bottom">
            <div class="vc-field"><div class="vc-fl">Card Holder</div><div class="vc-fv" id="vcHolder">-</div></div>
            <div class="vc-field"><div class="vc-fl">Expires</div><div class="vc-fv">12/28</div></div>
            <div class="vc-net">VISA</div>
          </div>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;gap:12px">
          <div class="card">
            <div class="card-title">Card Details</div>
            <div class="info-grid">
              <div class="info-item"><div class="info-lbl">Type</div><div class="info-val">Virtual Debit</div></div>
              <div class="info-item"><div class="info-lbl">Network</div><div class="info-val">VISA</div></div>
              <div class="info-item"><div class="info-lbl">Status</div><div class="info-val up">Active</div></div>
              <div class="info-item"><div class="info-lbl">3D Secure</div><div class="info-val up">Enabled</div></div>
            </div>
          </div>
        </div>
      </div>
      <div class="card mb18">
        <div class="card-title">Spending Summary</div>
        <div class="info-grid">
          <div class="info-item"><div class="info-lbl">Total Spent</div><div class="info-val down" id="cdDebit">-</div></div>
          <div class="info-item"><div class="info-lbl">Total Received</div><div class="info-val up" id="cdCredit">-</div></div>
          <div class="info-item"><div class="info-lbl">Transactions</div><div class="info-val" id="cdCount">-</div></div>
          <div class="info-item"><div class="info-lbl">Member Since</div><div class="info-val" id="cdSince">-</div></div>
        </div>
      </div>
    </div>
    <!-- PROFILE -->
    <div class="page" id="page-profile">
      <div class="page-header"><div class="page-h1">üë§ My Profile</div></div>
      <div class="card mb18">
        <div class="profile-hdr">
          <div class="profile-av" id="profAv">?</div>
          <div><div class="profile-name" id="profName">-</div><div class="profile-role" id="profRole">Customer</div></div>
          <div style="margin-left:auto"><span class="pill pill-green">Verified</span></div>
        </div>
        <div class="profile-grid">
          <div class="pf-field"><div class="pf-lbl">Username</div><div class="pf-val" id="pfUser">-</div></div>
          <div class="pf-field"><div class="pf-lbl">Email</div><div class="pf-val" id="pfEmail">-</div></div>
          <div class="pf-field"><div class="pf-lbl">Phone</div><div class="pf-val" id="pfPhone">-</div></div>
          <div class="pf-field"><div class="pf-lbl">Role</div><div class="pf-val" id="pfRole2"><span class="pill pill-violet">Customer</span></div></div>
          <div class="pf-field"><div class="pf-lbl">Member Since</div><div class="pf-val" id="pfSince">-</div></div>
          <div class="pf-field"><div class="pf-lbl">Balance</div><div class="pf-val up" id="pfBal">-</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Security</div>
        <div class="info-grid">
          <div class="info-item"><div class="info-lbl">Password</div><div class="info-val">Hidden</div></div>
          <div class="info-item"><div class="info-lbl">Session</div><div class="info-val up">Active JWT</div></div>
          <div class="info-item"><div class="info-lbl">Encryption</div><div class="info-val">256-bit SSL</div></div>
          <div class="info-item"><div class="info-lbl">2FA</div><div class="info-val" style="color:var(--yellow)">Coming Soon</div></div>
        </div>
      </div>
    </div>
    <!-- MARKET -->
    <div class="page" id="page-market">
      <div class="page-header"><div class="page-h1">üìà Market and Insights</div></div>
      <div class="market-grid">
        <div>
          <div class="section-title">üì∞ Financial News <span class="pill pill-green" style="margin-left:6px">Live</span></div>
          <div id="newsList"><div class="loading-center"><span class="spinner"></span></div></div>
        </div>
        <div>
          <div class="section-title">üåç World Bank Datasets</div>
          <div id="wbList"><div class="loading-center"><span class="spinner"></span></div></div>
          <div class="divider"></div>
          <div class="section-title">üíπ Market Tickers</div>
          <div class="tickers-list" id="tickerList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const API=window.KB_API||'http://localhost:5000/api';
// ‚îÄ‚îÄ Auth helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getToken(){return localStorage.getItem('kbtoken');}
function authFetch(url,opts={}){
  const t=getToken();
  const headers=Object.assign({},opts.headers||{});
  if(t)headers['Authorization']='Bearer '+t;
  return fetch(url,Object.assign({},opts,{headers,credentials:'include'}));
}
// Guard: redirect to login immediately if no token is stored
if(!getToken()){location.replace('login.html');}
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const RAPIDAPI_KEY='64d0e30511mshddf7bf026355b07p186714jsnc4c7e90848e4';
let currentUser=null,allTx=[],filteredTx=[],txPage=0,txFilter='all',balHidden=false,balValue=0;
const TX_PER_PAGE=10;
const $=id=>document.getElementById(id);
const inr=n=>new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:2}).format(n);
const fmtD=d=>new Date(d).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
const TITLES={dashboard:'Dashboard',transfer:'Send Money',transactions:'Transaction History',cards:'My Card',profile:'Profile',market:'Market and Insights'};
function nav(el,page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  $('page-'+page).classList.add('active');
  if(el)el.classList.add('active');
  $('topTitle').textContent=TITLES[page]||page;
  closeDropdowns();
  if(page==='transactions')renderTxTable();
  if(page==='profile')loadProfile();
  if(page==='market')loadMarket();
  if(page==='cards')renderCard();
}
function tick(){
  const n=new Date();
  $('dateStr').textContent=n.toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'long'});
  $('timeStr').textContent=' - '+n.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});
}
setInterval(tick,1000);tick();
function closeDropdowns(){$('notifDropdown').classList.remove('open');$('settingsDropdown').classList.remove('open');}
$('notifBtn').addEventListener('click',e=>{e.stopPropagation();$('settingsDropdown').classList.remove('open');$('notifDropdown').classList.toggle('open');});
$('settingsBtn').addEventListener('click',e=>{e.stopPropagation();$('notifDropdown').classList.remove('open');$('settingsDropdown').classList.toggle('open');});
document.addEventListener('click',closeDropdowns);
const NOTIFS=[
  {icon:'üí∞',text:'Your account balance was updated.',time:'Just now',color:'rgba(0,229,160,0.1)',read:false},
  {icon:'üîí',text:'New login detected from your device.',time:'2 min ago',color:'rgba(59,130,246,0.1)',read:false},
  {icon:'üìä',text:'Monthly statement is ready.',time:'1 hr ago',color:'rgba(124,58,237,0.1)',read:false},
];
function renderNotifs(){
  const unread=NOTIFS.filter(n=>!n.read).length;
  const badge=$('notifBadge');
  if(unread>0){badge.style.display='flex';badge.textContent=unread;}else{badge.style.display='none';}
  $('notifList').innerHTML=NOTIFS.map((n,i)=>
    '<div class="notif-item" onclick="markRead('+i+')" style="background:'+(n.read?'transparent':n.color)+'">'
    +'<div class="notif-icon" style="background:'+n.color+'">'+n.icon+'</div>'
    +'<div><div class="notif-text" style="color:'+(n.read?'var(--sub)':'var(--text)')+'">'+n.text+'</div>'
    +'<div class="notif-time">'+n.time+'</div></div></div>'
  ).join('');
}
function markRead(i){NOTIFS[i].read=true;renderNotifs();}
function clearAllNotifs(){NOTIFS.forEach(n=>n.read=true);renderNotifs();}
renderNotifs();
function toggleTheme(){document.body.style.filter=document.body.style.filter?'':'invert(1) hue-rotate(180deg)';}
function exportData(){
  const data=JSON.stringify({user:currentUser,transactions:allTx},null,2);
  const a=document.createElement('a');a.href='data:text/json,'+encodeURIComponent(data);
  a.download='kodbank-export.json';a.click();
}
function confirmLogout(){if(confirm('Sign out of Kodbank?'))doLogout();}
async function doLogout(){
  try{await authFetch(API+'/logout',{method:'POST'});}catch{}
  localStorage.removeItem('kbtoken');
  location.href='login.html';
}
$('logoutBtn').addEventListener('click',confirmLogout);
async function bootstrap(){
  try{
    const r=await authFetch(API+'/balance');
    if(r.status===401){localStorage.removeItem('kbtoken');location.href='login.html';return;}
    const b=await r.json();
    if(b.success){
      const{username,balance}=b.data;
      currentUser={username,balance};balValue=parseFloat(balance||0);
      const init=username[0].toUpperCase();
      $('sbAvatar').textContent=init;$('sbName').textContent=username;$('greetName').textContent=username;
      $('balVal').textContent=inr(balValue);$('balName').textContent='@'+username;
      const acct='AC'+String(Math.abs(username.charCodeAt(0)*3847+9127)).padStart(10,'0').slice(0,10);
      $('bhAcct').textContent=acct;
      $('tfBalDisp').textContent=inr(balValue);$('tpFrom').textContent=username;$('pfBal').textContent=inr(balValue);
    }
    loadTx();
  }catch(e){console.error('[bootstrap]',e);localStorage.removeItem('kbtoken');location.href='login.html';}
}
function addNotif(icon,text,time,color){NOTIFS.unshift({icon,text,time,color,read:false});renderNotifs();}
function refreshBal(){
  authFetch(API+'/balance').then(r=>r.json()).then(b=>{
    if(b.success){balValue=parseFloat(b.data.balance);if(!balHidden)$('balVal').textContent=inr(balValue);$('tfBalDisp').textContent=inr(balValue);$('pfBal').textContent=inr(balValue);}
  });
}
function toggleBal(){
  balHidden=!balHidden;
  $('balVal').textContent=balHidden?'Rs. xxxxxx':inr(balValue);
  $('hideBal').textContent=balHidden?'Show':'Hide';
}
async function loadTx(){
  try{
    const r=await authFetch(API+'/transactions?limit=100&offset=0');
    const b=await r.json();
    allTx=(b.success&&b.data&&b.data.transactions)?b.data.transactions:mockTx();
  }catch{allTx=mockTx();}
  filteredTx=[...allTx];computeStats();renderRecentTx();buildChart();
  if($('page-transactions').classList.contains('active'))renderTxTable();
}
function mockTx(){
  const descs=['Salary Credit','Online Shopping','Rent Payment','Food Delivery','Utility Bill','Transfer Received','Subscription'];
  const recs=['Alice','Bob','Charlie','Diana','Eve','System'];
  return Array.from({length:20},(_,i)=>({
    txid:i+1,type:i%3===0?'credit':'debit',
    amount:(Math.random()*9000+300).toFixed(2),
    description:descs[i%descs.length],
    recipient:recs[i%recs.length],
    status:i%9===0?'pending':'completed',
    created_at:new Date(Date.now()-i*86400000*2.5).toISOString()
  }));
}
function computeStats(){
  let cr=0,db=0,pn=0,cc=0,dc=0,pc=0;
  allTx.forEach(t=>{const a=parseFloat(t.amount);
    if(t.status==='pending'){pn+=a;pc++;}else if(t.type==='credit'){cr+=a;cc++;}else{db+=a;dc++;}
  });
  $('stCredit').textContent=inr(cr);$('stCreditC').textContent=cc+' entries';
  $('stDebit').textContent=inr(db);$('stDebitC').textContent=dc+' entries';
  $('stPending').textContent=inr(pn);$('stPendingC').textContent=pc+' pending';
  $('stCount').textContent=allTx.length;$('txCountLbl').textContent=allTx.length+' records';
  $('cdDebit').textContent=inr(db);$('cdCredit').textContent=inr(cr);$('cdCount').textContent=allTx.length;
  if(allTx.length)$('cdSince').textContent=fmtD(allTx[allTx.length-1].created_at);
}
function renderRecentTx(){
  const el=$('recentTx'),items=allTx.slice(0,6);
  if(!items.length){el.innerHTML='<div class="empty">No transactions yet.</div>';return;}
  el.innerHTML=items.map(txRow).join('');
}
function txRow(t){
  const isC=t.type==='credit',isP=t.status==='pending';
  const icon=isC?'üí∞':'üí∏';
  const iconBg=isC?'rgba(0,229,160,0.1)':isP?'rgba(251,191,36,0.1)':'rgba(255,92,122,0.1)';
  const badge=isP?'<span class="tx-badge bp">Pending</span>':isC?'<span class="tx-badge bc">Credit</span>':'<span class="tx-badge bd">Debit</span>';
  return '<div class="tx-item"><div class="tx-ico" style="background:'+iconBg+'">'+icon+'</div>'
    +'<div class="tx-info"><div class="tx-desc">'+(t.description||'Transfer')+'</div>'
    +'<div class="tx-meta">'+fmtD(t.created_at)+' - '+(t.recipient||'-')+'</div></div>'
    +'<div class="tx-right"><div class="tx-amt '+(isC?'up':'down')+'">'+(isC?'+':'-')+inr(t.amount)+'</div>'+badge+'</div></div>';
}
function buildChart(){
  const months=['J','F','M','A','M','J','J'];
  const vals=months.map(()=>Math.floor(Math.random()*80+20));
  const mx=Math.max(...vals);
  $('chartBars').innerHTML=vals.map((v,i)=>'<div class="cbar" data-v="Rs.'+(v*100).toLocaleString()+'" style="height:'+(v/mx*68)+'px;background:linear-gradient(180deg,var(--green),var(--violet))"></div>').join('');
  $('chartLabels').innerHTML=months.map(m=>'<div class="cbar-lbl" style="flex:1">'+m+'</div>').join('');
}
function filterTx(f,btn){
  txFilter=f;txPage=0;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');renderTxTable();
}
function onSearch(){
  const q=$('searchInput').value.toLowerCase();
  filteredTx=allTx.filter(t=>(t.description||'').toLowerCase().includes(q)||(t.recipient||'').toLowerCase().includes(q));
  txPage=0;
  if(!$('page-transactions').classList.contains('active'))
    nav(document.querySelector('[data-page=transactions]'),'transactions');
  else renderTxTable();
}
function renderTxTable(){
  let data=[...filteredTx];
  if(txFilter==='pending')data=data.filter(t=>t.status==='pending');
  else if(txFilter!=='all')data=data.filter(t=>t.type===txFilter);
  const tot=data.length,start=txPage*TX_PER_PAGE,sl=data.slice(start,start+TX_PER_PAGE);
  $('txPageInfo').textContent=tot?'Showing '+(start+1)+'-'+Math.min(start+TX_PER_PAGE,tot)+' of '+tot:'No results';
  $('btnPrev').disabled=txPage===0;$('btnNext').disabled=start+TX_PER_PAGE>=tot;
  if(!sl.length){$('txBody').innerHTML='<tr><td colspan="6"><div class="empty">No transactions found.</div></td></tr>';return;}
  $('txBody').innerHTML=sl.map(t=>{
    const isC=t.type==='credit';
    const badge=t.status==='pending'?'<span class="tx-badge bp">Pending</span>':isC?'<span class="tx-badge bc">Credit</span>':'<span class="tx-badge bd">Debit</span>';
    return '<tr><td style="color:var(--muted)">'+fmtD(t.created_at)+'</td>'
      +'<td style="font-weight:600">'+(t.description||'-')+'</td><td>'+badge+'</td>'
      +'<td style="color:var(--sub)">'+(t.recipient||'-')+'</td>'
      +'<td class="'+(isC?'up':'down')+'" style="font-weight:800">'+(isC?'+':'-')+inr(t.amount)+'</td>'
      +'<td>'+(t.status==='completed'?'<span class="up">Done</span>':'<span style="color:var(--yellow)">Pending</span>')+'</td></tr>';
  }).join('');
}
function changePage(d){txPage+=d;renderTxTable();}
function tfPreview(){
  const r=$('tf-rec').value.trim(),a=$('tf-amt').value;
  const prev=$('tf-preview');
  if(r&&a>0){prev.style.display='block';$('tpTo').textContent=r;$('tpAmt').textContent=inr(a);}
  else prev.style.display='none';
}
async function doTransfer(){
  const rec=$('tf-rec').value.trim();const amt=parseFloat($('tf-amt').value);const desc=$('tf-desc').value.trim();
  const ax=$('tf-alert');ax.className='alert';
  function showTfAlert(m,t){ax.innerHTML='<span>'+(t==='success'?'ok':'x')+'</span> '+m;ax.className='alert '+t+' show';}
  if(!rec){showTfAlert('Enter a recipient username.','error');return;}
  if(!amt||amt<=0){showTfAlert('Enter a valid amount.','error');return;}
  if(amt>balValue){showTfAlert('Insufficient balance.','error');return;}
  $('tfBtn').disabled=true;$('tfBtn').innerHTML='<span class="spinner"></span>Sending...';
  try{
    const r=await authFetch(API+'/transfer',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({recipient:rec,amount:amt,description:desc})});
    const b=await r.json();
    if(!r.ok){showTfAlert(b.message||'Transfer failed.','error');}
    else{
      showTfAlert('Transfer successful!','success');
      balValue-=amt;$('balVal').textContent=inr(balValue);$('tfBalDisp').textContent=inr(balValue);$('pfBal').textContent=inr(balValue);
      $('tf-rec').value='';$('tf-amt').value='';$('tf-desc').value='';$('tf-preview').style.display='none';
      addNotif('‚ÜóÔ∏è','Transfer of '+inr(amt)+' to '+rec+' completed.','Just now','rgba(0,229,160,0.1)');
      loadTx();
    }
  }catch{showTfAlert('Network error.','error');}
  finally{$('tfBtn').disabled=false;$('tfBtn').textContent='Send Money';}
}
async function loadProfile(){
  try{
    const r=await authFetch(API+'/profile');
    const b=await r.json();
    setProfile(b.success&&b.data?b.data:{});
  }catch{if(currentUser)setProfile({...currentUser,email:'-',phone:'-',role:'customer',created_at:new Date()});}
}
function setProfile(d){
  const init=(d.username||'?')[0].toUpperCase();
  $('profAv').textContent=init;$('profName').textContent=d.username||'-';$('profRole').textContent=d.role||'customer';
  $('pfUser').textContent='@'+(d.username||'-');$('pfEmail').textContent=d.email||'-';$('pfPhone').textContent=d.phone||'-';
  $('pfRole2').innerHTML='<span class="pill pill-violet">'+(d.role||'customer')+'</span>';
  $('pfSince').textContent=d.created_at?fmtD(d.created_at):'-';$('pfBal').textContent=inr(balValue);
}
function renderCard(){
  if(!currentUser)return;
  $('vcHolder').textContent=currentUser.username.toUpperCase();
  const uid=currentUser.username.split('').reduce((a,c)=>a+c.charCodeAt(0),0);
  $('vcNum').textContent='4000 '+String(uid*37%9999+1000).slice(0,4)+' '+String(uid*13%9999+2000).slice(0,4)+' 8219';
  if(allTx.length&&!$('cdSince').textContent.match(/d/))$('cdSince').textContent=fmtD(allTx[allTx.length-1].created_at);
}
const MOCK_NEWS=[
  {category:'Banking',title:'RBI holds repo rate steady at 6.5% amid inflation',source:'Financial Express',time:'2h ago'},
  {category:'Markets',title:'Sensex rallies 400 points; IT and banking lead gains',source:'ET Markets',time:'3h ago'},
  {category:'Crypto',title:'Bitcoin surpasses $98,000 as institutional demand rises',source:'CoinDesk',time:'5h ago'},
  {category:'Global',title:'Fed signals two rate cuts possible in 2026',source:'Reuters',time:'6h ago'},
  {category:'Fintech',title:'UPI transactions hit record 16 billion in January 2026',source:'NPCI',time:'1d ago'},
  {category:'IPO',title:'Digital banks dominate Q4 FY26 earnings season',source:'Bloomberg',time:'1d ago'},
];
const MOCK_WB=[
  {name:'World Development Indicators',description:'GDP, poverty and trade - 217 economies',update:'Jan 2026',entries:'1600+'},
  {name:'Global Financial Inclusion',description:'Access to financial services worldwide',update:'Dec 2025',entries:'148'},
  {name:'International Debt Statistics',description:'External debt of low-income countries',update:'Feb 2026',entries:'209'},
  {name:'Doing Business Indicators',description:'Ease of business across 190 economies',update:'Nov 2025',entries:'190'},
];
const MOCK_TICKERS=[
  {sym:'NIFTY',name:'Nifty 50',price:'22,847',chg:'+1.32%',up:true},
  {sym:'SENSEX',name:'BSE Sensex',price:'75,412',chg:'+1.18%',up:true},
  {sym:'USDINR',name:'USD/INR',price:'84.23',chg:'-0.12%',up:false},
  {sym:'GOLD',name:'Gold MCX',price:'Rs.82,450',chg:'+0.45%',up:true},
  {sym:'NIFTYIT',name:'Nifty IT',price:'37,241',chg:'-0.67%',up:false},
  {sym:'BTC',name:'Bitcoin',price:'$98,120',chg:'+2.14%',up:true},
];
function loadMarket(){renderNews(MOCK_NEWS);renderWB(MOCK_WB);renderTickers(MOCK_TICKERS);tryWB();tryMS();}
async function tryWB(){
  try{
    const r=await fetch('https://community-worldbank.p.rapidapi.com/datacatalog?format=json',
      {headers:{'x-rapidapi-host':'community-worldbank.p.rapidapi.com','x-rapidapi-key':RAPIDAPI_KEY}});
    if(!r.ok)return;const data=await r.json();
    const items=(Array.isArray(data)?data:(data.datacatalog||[])).slice(0,4);
    if(items.length)renderWB(items.map(it=>({name:it.name||'Dataset',description:it.description||'',update:it.lastupdated||'2026',entries:it.records||'-'})));
  }catch{}
}
async function tryMS(){
  try{
    const r=await fetch('https://morning-star.p.rapidapi.com/articles/get-details',
      {headers:{'x-rapidapi-host':'morning-star.p.rapidapi.com','x-rapidapi-key':RAPIDAPI_KEY}});
    if(!r.ok)return;const data=await r.json();
    const arts=Array.isArray(data)?data:(data.articles||data.data||[]);
    if(arts.length)renderNews(arts.slice(0,6).map(a=>({category:a.sectorName||'Finance',title:a.title||a.headline||'Article',source:a.source||'Morningstar',time:a.publishDate?fmtD(a.publishDate):''})));
  }catch{}
}
function renderNews(items){
  $('newsList').innerHTML=items.map(n=>'<div class="news-item"><div class="news-cat">'+n.category+'</div><div class="news-title">'+n.title+'</div><div class="news-meta">'+n.source+' - '+n.time+'</div></div>').join('');
}
function renderWB(items){
  $('wbList').innerHTML=items.map(d=>'<div class="wb-item"><div class="wb-name">'+d.name+'</div><div class="wb-desc">'+d.description+'</div><div class="wb-meta"><span>Updated: '+d.update+'</span><span>Records: '+d.entries+'</span></div></div>').join('');
}
function renderTickers(list){
  $('tickerList').innerHTML=list.map(t=>'<div class="ticker-row"><div class="ticker-sym">'+t.sym+'</div><div class="ticker-name">'+t.name+'</div><div><div class="ticker-price">'+t.price+'</div><div class="ticker-chg '+(t.up?'up':'down')+'">'+t.chg+'</div></div></div>').join('');
  setInterval(()=>{
    document.querySelectorAll('.ticker-chg').forEach(el=>{
      const d=(Math.random()*.12-.06).toFixed(2),up=parseFloat(d)>=0;
      el.textContent=(up?'+':'')+d+'%';el.className='ticker-chg '+(up?'up':'down');
    });
  },3500);
}
bootstrap();
</script>
</body>
</html>